id: prague_population_infrastructure_small
title: "Prague: Population & Infrastructure (GeoParquet)"

# Prague-clipped subset of the CZ infrastructure dataset, stored as GeoParquet.
# Intended as a small, reproducible fixture to exercise the DuckDB+GeoParquet path.
dataSize: small
enabled: true

defaultView:
  center:
    lat: 50.0755
    lon: 14.4378
  zoom: 10.5

examplePrompts:
  - "show layers"
  - "how many places are flooded?"
  - "show flooded places"
  - "show me escape roads for flooded places"
  - "highlight motorways"
  - "highlight trunks"

layers:
  - id: roads
    title: "Roads (lines)"
    kind: lines
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/prague_bbox/roads.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
        # Keep consistent with the large scenario; decode geometry progressively by class.
        minZoomForGeometry: 11.5
        renderPolicy:
          # Show a readable “overview” at low zoom by decoding only major road classes,
          # then progressively allow smaller classes as the user zooms in.
          minZoomForGeometryByClass:
            motorway: 6.0
            motorway_link: 6.0
            trunk: 6.0
            trunk_link: 6.0
            primary: 6.5
            primary_link: 6.5
            secondary: 7.0
            secondary_link: 7.0
            tertiary: 9.0
            tertiary_link: 9.0
            # Minor classes are dense even in Prague; keep them off until high zoom.
            residential: 13.5
            unclassified: 13.5
            service: 14.0
            living_street: 14.0
            cycleway: 14.5
            busway: 14.5
            footway: 15.0
            path: 15.0
            steps: 15.5
            track: 15.5
            track_grade1: 15.5
            track_grade2: 15.5
            track_grade3: 15.5
            track_grade4: 15.5
            track_grade5: 15.5
            pedestrian: 15.5
            bridleway: 15.5
    style:
      line:
        color: "rgba(55, 71, 79, 0.55)"
        width: 1

  - id: water_areas
    title: "Water areas (polygons)"
    kind: polygons
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/prague_bbox/water_areas.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
        minZoomForGeometry: 11.5
    style:
      fillcolor: "rgba(30, 136, 229, 0.15)"
      line:
        color: "rgba(30, 136, 229, 0.45)"
        width: 1

  - id: places
    title: "Places (points)"
    kind: points
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/prague_bbox/places.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
    style:
      marker:
        size: 6
        color: "rgba(255, 193, 7, 0.60)"

routing:
  primaryPointsLayerId: places
  maskPolygonsLayerId: water_areas
  pointLabelSingular: place
  pointLabelPlural: places
  maskLabel: water areas
  showLayersKeywords: ["show layers", "help", "reset", "start over"]
  countKeywords: ["how many"]
  maskKeywords: ["flood", "flooded", "water"]
  recommendKeywords: ["recommend", "find"]
  highlightRules:
    - keywords: ["show flooded places", "highlight flooded places"]
      layerId: places
      title: "Flooded places"
      maxFeatures: 500
      maskLayerId: water_areas
      maskMode: IN_MASK
    - keywords: ["highlight motorways", "highlight motorway", "highlight highways"]
      layerId: roads
      title: "Motorways"
      maxFeatures: 800
      props:
        # Include *_link too: in-city segments are frequently stored as link classes.
        fclass: ["motorway", "motorway_link"]
    - keywords: ["highlight trunks", "highlight trunk"]
      layerId: roads
      title: "Trunks"
      maxFeatures: 800
      props:
        fclass: ["trunk", "trunk_link"]

plot:
  highlightLayerId: places

