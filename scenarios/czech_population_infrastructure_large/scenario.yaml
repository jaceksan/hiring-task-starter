id: czech_population_infrastructure_large
title: "Czech Republic: Population & Infrastructure (Large)"

# GeoParquet-backed large scenario (query-on-read via DuckDB `read_parquet()`).
enabled: true
dataSize: large

defaultView:
  center:
    lat: 49.8175
    lon: 15.4730
  zoom: 6.6

examplePrompts:
  - "show layers"
  - "how many places are flooded?"
  - "show flooded places"
  - "highlight motorways"

layers:
  - id: roads
    title: "Roads (lines)"
    kind: lines
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/cz_bbox/roads.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
        minZoomForGeometry: 11.5
        renderPolicy:
          # Show a readable “overview” at low zoom by decoding only major road classes,
          # then progressively allow smaller classes as the user zooms in.
          minZoomForGeometryByClass:
            motorway: 6.0
            motorway_link: 6.0
            trunk: 6.0
            trunk_link: 6.0
            primary: 6.5
            primary_link: 6.5
            secondary: 7.0
            secondary_link: 7.0
            tertiary: 9.0
            tertiary_link: 9.0
            # Minor classes are extremely dense in the CZ dataset. Keep them off until very
            # high zoom; otherwise decoding + JSON serialization become unstable (multi-second).
            residential: 13.5
            unclassified: 13.5
            service: 14.0
            living_street: 14.0
            cycleway: 14.5
            busway: 14.5
            footway: 15.0
            path: 15.0
            steps: 15.5
            track: 15.5
            track_grade1: 15.5
            track_grade2: 15.5
            track_grade3: 15.5
            track_grade4: 15.5
            track_grade5: 15.5
            pedestrian: 15.5
            bridleway: 15.5
          # Hard cap of “geometry candidates” before any Python simplification/LOD.
          # Keys are maxZoom thresholds.
          maxCandidatesByZoom:
            7.5: 1200
            9.0: 2500
            12.0: 5000
            13.5: 7000
            15.0: 9000
            24.0: 9000
    style:
      line:
        color: "rgba(55, 71, 79, 0.55)"
        width: 1

  - id: water_areas
    title: "Water areas (polygons)"
    kind: polygons
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/cz_bbox/water_areas.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
        minZoomForGeometry: 11.5
        renderPolicy:
          # Same idea as roads: show only the most significant water polygons when zoomed out.
          minZoomForGeometryByClass:
            water: 6.0
            reservoir: 6.0
            wetland: 9.5
            riverbank: 11.5
          maxCandidatesByZoom:
            7.5: 600
            9.0: 1200
            12.0: 3500
            24.0: 6000
    style:
      fillcolor: "rgba(30, 136, 229, 0.15)"
      line:
        color: "rgba(30, 136, 229, 0.45)"
        width: 1

  - id: places
    title: "Places (points)"
    kind: points
    source:
      type: geoparquet
      path: data/derived/czech_population_infrastructure_large/cz_bbox/places.parquet
      geoparquet:
        idColumn: osm_id
        nameColumn: name
        classColumn: fclass
        geometryColumn: geometry
        renderPolicy:
          # Keep the low-zoom overview interactive: this dataset contains *a lot* of place points.
          # Capping early dramatically reduces backend time spent scanning/reading candidates.
          maxCandidatesByZoom:
            7.5: 1500
            9.0: 3000
            12.0: 8000
            24.0: 15000
    style:
      marker:
        size: 6
        color: "rgba(255, 193, 7, 0.60)"

routing:
  primaryPointsLayerId: places
  maskPolygonsLayerId: water_areas
  pointLabelSingular: place
  pointLabelPlural: places
  maskLabel: water areas
  showLayersKeywords: ["show layers", "help", "reset", "start over"]
  countKeywords: ["how many"]
  maskKeywords: ["flood", "flooded", "water"]
  recommendKeywords: ["recommend", "find"]
  highlightRules:
    - keywords: ["show flooded places", "highlight flooded places"]
      layerId: places
      title: "Flooded places"
      maxFeatures: 500
      maskLayerId: water_areas
      maskMode: IN_MASK
    - keywords: ["highlight motorways", "highlight motorway", "highlight highways"]
      layerId: roads
      title: "Motorways"
      maxFeatures: 800
      props:
        fclass: ["motorway", "trunk"]

plot:
  highlightLayerId: places

